# 地图格子生成工具

## 项目概述

这是一个基于Web的地图格子生成工具，支持创建可配置大小的网格地图，并提供缩放、数据导出、资源分配等功能。该工具使用HTML5 Canvas技术进行可视化渲染。

## 主要功能

### 核心功能
- **地图生成**: 支持自定义地图尺寸和格子大小
- **螺旋编号**: 逆时针螺旋编号，从左下角开始
- **圈层管理**: 支持按圈层高亮和批量操作
- **资源分配**: 支持为圈层批量分配怪物和资源
- **交互操作**: 点击选择格子、右键拖拽移动
- **缩放控制**: 放大/缩小格子和地图显示
- **数据导出**: 生成包含所有格子坐标数据的文本文件

### 新增功能 (v2.1)
- **怪物管理**: 按类型显示怪物列表，支持批量分配到指定圈层
- **资源管理**: 按类型显示资源列表，支持批量分配到指定圈层
- **数量控制**: 自定义每个怪物/资源的分配数量
- **分离导出**: 分别导出怪物和资源数据，便于游戏配置
- **可视化标识**: 在地图格子上显示已分配资源的简要标识

## 技术特点
- **响应式设计**: 画布容器自适应浏览器窗口大小
- **固定画布**: Canvas画布固定1200×1200像素
- **动态缩放**: 格子在画布中自动适配缩放
- **坐标系统**: 基于Canvas的2D坐标系，原点在左下角

## 文件结构

```
map/
├── index.html          # 主要的HTML文件，包含所有JavaScript代码
├── map-resources.js    # 资源数据配置文件
├── README.md          # 项目说明文档
├── 1.jpg             # 项目参考效果图
├── .gitignore        # Git忽略文件配置
└── .claude/          # Claude Code配置目录
```

## 使用方法

### 1. 打开工具
在浏览器中打开 `index.html` 文件

### 2. 基本设置
- **地图宽度**: 设置地图宽度（像素）
- **地图高度**: 设置地图高度（像素）
- **格子边长**: 设置每个格子的边长（像素）
- **倾斜角度**: 设置地图倾斜角度（0-90度）

### 3. 生成地图
点击"生成地图"按钮或按 `G` 键

### 4. 圈层操作
- **选择圈层**: 在圈层列表中选择要操作的圈层（支持多选）
- **高亮圈层**: 选择圈层后点击"高亮选择"按钮
- **清除高亮**: 点击"清除高亮"按钮

### 5. 资源分配
- **怪物分配**:
  1. 选择目标圈层
  2. 在怪物列表中选择要分配的怪物（支持多选）
  3. 设置每个怪物的数量
  4. 点击"添加怪物到选择圈层"
- **资源分配**:
  1. 选择目标圈层
  2. 在资源列表中选择要分配的资源（支持多选）
  3. 设置每个资源的数量
  4. 点击"添加资源到选择圈层"

### 6. 操作控制
- **选择格子**: 左键点击任意格子查看详情
- **拖拽移动**: 右键按住并拖拽
- **放大**: 点击"放大"按钮或按 `+`/`=` 键
- **缩小**: 点击"缩小"按钮或按 `-` 键
- **导出数据**: 点击"打印数据"按钮或按 `S` 键
- **导出资源**: 点击"导出(怪物先，空行，再资源)"按钮

### 7. 查看信息
点击格子后右侧信息面板显示详细信息，包括：
- 格子编号
- 位置（行列）
- 圈层信息
- 四个角的坐标点
- 已分配的怪物和资源信息

## 键盘快捷键

| 按键 | 功能 |
|------|------|
| `G` | 生成地图 |
| `+` / `=` | 放大 |
| `-` | 缩小 |
| `0` | 重置缩放 |
| `S` | 导出坐标数据 |

## 输出数据格式

### 坐标数据导出
导出的文本文件格式：
```
格子编号:左下角X;左下角Y|左上角X;左上角Y|右上角X;右上角Y|右下角X;右下角Y
1:0;0|0;99|99;99|99;0
2:100;0|100;99|199;99|199;0
...
```

### 资源数据导出
分别导出怪物和资源数据，格式：
```
怪物数据（如果存在）:
格子ID:怪物ID;数量|怪物ID;数量
格子ID:怪物ID;数量

资源数据（如果存在）:
格子ID:资源ID;数量|资源ID;数量
格子ID:资源ID;数量
```

## 资源配置

项目包含预配置的怪物和资源数据：

### 怪物类型 (type=1)
- **动物**: 1-30级鹿、狼、熊
- **BOSS**: 1-10级Boss

### 资源类型 (type=2)
- **废弃种植园**: 1-8级
- **废弃木材场**: 1-8级
- **废弃煤矿场**: 1-8级
- **废弃炼铁厂**: 1-8级

## 技术架构

### 前端技术栈
- **HTML5**: 页面结构和Canvas元素
- **CSS3**: 响应式布局和样式设计
- **JavaScript ES6+**: 核心逻辑和交互功能
- **Canvas API**: 地图绘制和图形渲染

### 核心类
- **MapTools**: 地图生成、绘制和交互控制

### 关键算法
- **螺旋生成算法**: 逆时针螺旋编号
- **坐标转换**: Canvas坐标系统转换
- **多边形检测**: 射线法检测点在多边形内

## 开发历史

### 版本信息
- **当前版本**: v2.1
- **最后更新**: 2025年11月
- **开发者**: Claude Code Assistant

### 主要更新
- **v1.0**: 基础地图生成和编号功能
- **v1.5**: 添加45°旋转视角和交互功能
- **v2.0**:
  - 移除视角选择功能，固定0°视角
  - 优化画布大小为固定1200×1200
  - 改进缩放逻辑，只影响格子显示
  - 完善响应式布局和用户体验
- **v2.1**:
  - 新增怪物和资源管理功能
  - 支持批量分配资源到圈层
  - 添加分离导出功能
  - 优化用户界面和操作体验

## 常见问题

### Q: 地图生成失败怎么办？
A: 检查输入参数是否在有效范围内，地图尺寸应在100-2000像素，格子大小应在10-200像素。

### Q: 如何批量分配资源？
A: 选择目标圈层后，在对应的怪物/资源列表中选择项目，设置数量，然后点击相应的分配按钮。

### Q: 导出的数据文件在哪里？
A: 文件会自动下载到浏览器默认下载目录，文件名包含时间戳信息。

### Q: 如何查看格子已分配的资源？
A: 点击任意格子，右侧信息面板会显示详细的分配信息，地图格子上也会显示简要标识。

### Q: 支持哪些浏览器？
A: 支持Chrome、Firefox、Safari、Edge等现代浏览器的较新版本。

## 浏览器兼容性

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## Git 管理

### 仓库信息
- **GitHub 仓库地址**: https://github.com/hongda2046/map_tools
- **当前分支**: main

### 常用 Git 命令
```bash
git status                    # 查看工作区状态
git add .                    # 添加所有文件到暂存区
git commit -m "提交信息"     # 提交暂存区的文件
git push origin main          # 推送到远程仓库
git pull origin main          # 拉取远程仓库更新
```

### 提交消息格式
```
<类型>: <简要描述>

详细描述（可选）
```

**类型说明**:
- `feat`: 新功能
- `fix`: 问题修复
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构

## 许可证

本项目采用MIT许可证。

## 贡献

欢迎提交Issue和Pull Request来改进项目功能。

---

**项目创建**: 2025年11月
**当前版本**: v2.1
**技术支持**: HTML5 Canvas + 原生JavaScript
**适用场景**: 地图设计、网格系统开发、游戏资源配置、教学演示